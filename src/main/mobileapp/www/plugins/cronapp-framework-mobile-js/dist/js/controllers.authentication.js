!function(o){angular.module("custom.controllers",[]),app.controller("LoginController",["$scope","$http","$location","$rootScope","$window","$state","$translate","Notification","$ionicLoading","$timeout","$stateParams",function(o,e,n,s,t,i,a,r,d,p,l){function u(o,e,n,s){"undefined"!=typeof Storage&&sessionStorage.setItem("_u",JSON.stringify(o)),i.go("app.home"),p(function(){d.hide()},500)}function c(o,e,n,s){var t=401==e?a.instant("Login.view.invalidPassword"):o;t||(t=a.instant("General.ErrorNotSpecified")),console.log(t),d.hide(),r.error(t)}app.registerEventsCronapi(o,a),s.http=e,o.Notification=r;for(var w in app.userEvents)o[w]=app.userEvents[w].bind(o);o.user={},o.message={},o.login=function(){d.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),o.message.error=void 0,window.hostApp?e({method:"POST",url:window.hostApp+"auth",data:$.param(o.user),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(u).error(c):(d.hide(),r.error("HostApp is required!"))},s.infiniteReached=function(){}}]),app.controller("HomeController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal",function(o,e,n,s,t,i,a,r,d){function p(){e({method:"GET",url:window.hostApp+"auth/refresh"}).success(function(o,e,n,s){console.log("revive :",new Date(o.expires)),sessionStorage.setItem("_u",JSON.stringify(o)),setTimeout(function(){p()},18e5)}).error(function(){})}app.registerEventsCronapi(o,i),n.http=e,o.Notification=a;for(var l in app.userEvents)o[l]=app.userEvents[l].bind(o);d.fromTemplateUrl("views/logged/_changepassword.view.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e}),o.openChangePassword=function(){o.modal.show()},o.closeChangePassword=function(){o.modal.hide()},o.shouldShowDelete=!1,o.shouldShowReorder=!1,o.listCanSwipe=!0,o.message={},o.selecionado={valor:1},n.session=sessionStorage._u?JSON.parse(sessionStorage._u):null,n.session||s.go("login"),n.logout=function(){n.session={},"undefined"!=typeof Storage&&sessionStorage.removeItem("_u"),s.go("login")},o.changePassword=function(){function n(o,e,n,s){a.info(i.instant("Home.view.passwordChanged")),t()}function s(o,e,n,s){var t=e>=401?i.instant("Home.view.InvalidPassword"):o;a.error(t)}function t(){oldPassword.value="",newPassword.value="",newPasswordConfirmation.value="",o.closeChangePassword()}var r={oldPassword:oldPassword.value,newPassword:newPassword.value,newPasswordConfirmation:newPasswordConfirmation.value};e({method:"POST",url:window.hostApp+"changePassword",data:$.param(r),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(n).error(s)},n.session?n.session.token&&p():s.go("login")}])}(app),window.safeApply=function(o){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?o&&"function"==typeof o&&o():this.$apply(o)};